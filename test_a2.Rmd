---
title: "test_a2"
author: "Chengxi"
date: "2025-04-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.



```{r}
install.packages("ncdf4")
install.packages("stars")
```

```{r}
library(ncdf4)
library(stars)
library(dplyr)
```

```{r}
url <- "D:/Study/University/DATA3888/Assignment/A2/ct5km_ssta-min_v3.1_2022.nc"

nc_data <- nc_open(url)
print(nc_data)

names(nc_data$var)

#nc_close(nc_data)
```

```{r}
temp_anomaly <- ncvar_get(nc_data, "sea_surface_temperature_anomaly", collapse_degen = FALSE)
tmp_date <- ncvar_get(nc_data, "date", collapse_degen = FALSE)
tmp_mask <- ncvar_get(nc_data, "mask", collapse_degen = FALSE)
lon <- ncvar_get(nc_data, "lon")
lat <- ncvar_get(nc_data, "lat")
```

```{r}
dim(temp_anomaly)
```


```{r}
grid <- expand.grid(
  lon = lon,
  lat = lat
)

temp_vals <- as.vector(temp_anomaly[,,1]) * 0.01  # Apply scale
date_vals <- as.vector(tmp_date[,,1])
mask_vals <- as.vector(tmp_mask[,,1])

```

```{r}
df <- data.frame(
  lon = grid$lon,
  lat = grid$lat,
  sst_anomaly = temp_vals,
  date = date_vals,
  mask = mask_vals
)
```

```{r}
df_clean <- df %>%
  filter(!is.na(sst_anomaly), !is.na(date))
df_clean
```

