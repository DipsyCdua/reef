---
title: "postgres_test"
author: "Chengxi"
date: "2025-04-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("DBI")
install.packages("RPostgres")
install.packages("RSQLite")
```

```{r}
library(DBI)
library(RPostgres)
library(RSQLite)
```


# use to load the data to db
```{r}
sqlite_con <- dbConnect(RSQLite::SQLite(), "D:/R_studio_working_dir/DATA3888_group/Global_Coral_Bleaching_Database_SQLite_11_24_21.db")
```

# Must connect and disconect after use
```{r}
con <- dbConnect(
  RPostgres::Postgres(),
  dbname = "Data3888_Global_Coral_Bleaching_Database",
  host = "localhost",
  port = 5432,
  user = "postgres",
  password = "magic123"
)
```

# write data into db

```{r}
# List SQLite tables
tables <- dbListTables(sqlite_con)

# For each table, read from SQLite and write to PostgreSQL
for (tbl in tables) {
  data <- dbReadTable(sqlite_con, tbl)
  dbWriteTable(con, tbl, data, overwrite = TRUE)
}
```

# list all the colname from the database

```{r}
for (tbl in tables) {
  cat("Table:", tbl, "\n")
  cols <- dbListFields(sqlite_con, tbl)
  print(cols)
  cat("\n")
}
```

# list first 5 row data from Query_6_Sites_with_Multiple_Sample_Events

```{r}
cmd <- "SELECT * FROM \"Query_6_Sites_with_Multiple_Sample_Events\" LIMIT 5"
result <- dbGetQuery(con, cmd)
result
```


# Must Disconnect

```{r}

dbDisconnect(sqlite_con)
dbDisconnect(con)
```

